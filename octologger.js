!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.octologger={})}(this,function(e){"use strict";var d={entry:0,scope:1},v="idle",g="interactive",h="completed",b="cancelled",E="failed",y={error:0,warn:1,info:2,verbose:3,debug:4,log:5,success:6},o={};for(var t in y)o[y[t]]=t;var l=/at\s+(?:([^\s]+)(?:.*?)\()?((?:http|file|\/)[^)]+:\d+)\)?/,a=/^(.*?)(?:\/<)*@(.*?)$/,u=/^()(https?:\/\/.+)/,i=/^(.*?):(\d+)(?::(\d+))?$/,c="<anonymous>";function s(e){if(null==e)return null;var t=e.match(l);if(null===t&&(t=e.match(a)||e.match(u)),t){var n=t[2].match(i),r={fn:void 0===t[1]?c:t[1].trim()||c,file:"",line:0,column:0};return n&&(r.file=n[1],r.line=parseInt(n[2],10)||0,r.column=parseInt(n[3],10)||0),r}return null}function r(e){if(null==e)return null;for(var t=e.trim().split("\n"),n=[],r=0;r<t.length;r++){var o=s(t[r]);null!==o&&n.push(o)}return n}var T=Function("return this")(),C="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:Date.now;function f(e,t){var n=e<10?"0"+e:e;return 1<t&&e<100&&(n="0"+n),n}function p(e,t){e[t].toString=function(){return"function "+t+"() { [native code] }"}}var n=/:([^;]+)/g;function m(n,r){return function(e){var t=o[e.level];return r(t,e,n?{base:n.level[t],label:n.label[t]}:null)}}var I=m({level:{error:"[31m",warn:"[33m",log:"[0m",info:"[34m",success:"[34m",verbose:"[35m",debug:"[35m"},label:{error:"[4m",warn:"[4m",log:"[4m",info:"[4m",success:"[4m",verbose:"[4m",debug:"[4m"}},function(e,t,n){var r=[];return null!==t.badge&&r.push(t.badge),null!==t.label&&r.push(""+n.base+n.label+t.label+"[0m"),null!==t.message&&r.push(""+n.base+t.message),null!==t.detail&&r.push(t.detail),null!==t.meta&&r.push(t.meta.file+":"+t.meta.line+":"+t.meta.column+" ("+t.meta.fn+")"),r.push("[0m"),r}),L="text-decoration: underline; font-weight: bold;";function w(e){return e.replace(n,": inherit")}var x=m({level:{error:"color: red;",warn:"color: orange;",log:"color: #333;",success:"color: #1aaa55;",info:"color: dodgerblue;",verbose:"color: magenta;",debug:"color: #8b1fdd;"},label:{error:L,warn:L,log:L,info:L,success:L,verbose:L,debug:L}},function(e,t,n){var r,o,l=[],a=[];if(null!==t.ts&&(l.push("%c[%s] "),a.push(n.base,(r=t.ts,f((o=r/1e3)/60%24|0)+":"+f(o%60|0)+"."+f(r%1e3|0,2)))),null!==t.badge&&(l.push("%s"),a.push(t.badge)),null!==t.label&&(l.push("%c%s%c "),a.push(n.label+n.base,t.label,w(n.label))),null!==t.message&&(l.push("%c%s "),a.push(n.base,t.message)),null!=t.detail){var u=t.detail,i=u.length;if(null===t.message&&0<=i&&0 in u){l.push("%c"),a.push(n.base);for(var c=0;c<i;c++){var s=u[c];l.push(("string"==typeof s?"%s":"%o")+" "),a.push(s)}}else l.push("%o "),a.push(u)}return null!==t.meta&&(l.push("%s"),a.push(t.meta.file+":"+t.meta.line+":"+t.meta.column+" ("+t.meta.fn+")")),a.unshift(l.join("")),a}),A=T.console,P=T.setTimeout,S=T.clearTimeout,k=T.setInterval,O=T.clearInterval,_=T.setImmediate,F=T.clearImmediate,D=T.requestIdleCallback,N=T.cancelIdleCallback,R=T.requestAnimationFrame,j=T.cancelAnimationFrame,q=T.Promise,B=q.prototype,M=q,U={},V={};["all","race","reject","resolve"].forEach(function(e){U[e]=q[e]}),["then","catch","finally"].forEach(function(e){V[e]=B[e]});var Y=Object.freeze({console:A,setTimeout:P,clearTimeout:S,setInterval:k,clearInterval:O,setImmediate:_,clearImmediate:F,requestIdleCallback:D,cancelIdleCallback:N,requestAnimationFrame:R,cancelAnimationFrame:j,NativePromise:q,PromiseConstructor:M,PromiseStatic:U,PromisePrototype:V}),$=function(e){var a=e.out,u=e.format,i=a.log,c={},s=[];return function n(e,t){if(null===e)return s.forEach(function(){a.groupEnd()}),void(s.length=0);var r=e.parent,o=s.length;if(!t||!e.printed){if(0<o){for(var l=o;l--&&s[l]!==r;)s[l].printed=!0,a.groupEnd();s.length=l+1}if(e.type===d.scope)"idle"===e.detail.state?(e.printed=!0,i.apply(a,u(e))):(s.push(e),a.group.apply(a,u(e)));else{if(!t&&r.printed&&"#root"!==r.label)return void(c[r.cid]||(c[r.cid]=P(function(){s.forEach(function(){a.groupEnd()}),s.length=0;for(var e=[],t=r;e.unshift(t),"#root"!==(t=t.parent).label;);e.forEach(function(e){a.group.apply(a,u(e))}),r.entries.forEach(function(e){n(e,!0)}),e.forEach(function(){a.groupEnd()})})));e.printed=!0,i.apply(a,u(e))}}}},z=function(e){return void 0===e&&(e={}),$({out:e.out||A,format:e.format||I})},G=function(e){return void 0===e&&(e={}),$({out:e.out||A,format:e.format||x})},J="undefined"!=typeof window?G:z,K=0;function H(e){return e&&e.hasOwnProperty("type")&&e.hasOwnProperty("level")}function Q(e,t,n,r,o,l){return void 0===l&&(l=null),{cid:++K,ts:null,type:d.entry,level:e,badge:t,label:n,message:r,detail:o,meta:l,parent:null,entries:[]}}function W(e){void 0===e&&(e=0);var t=Error.stackTraceLimit;Error.stackTraceLimit=e+1;var n=((new Error).stack||"").split("\n");return Error.stackTraceLimit=t,n.length<=e+1?null:s(n[e+1])}function X(l,a){return{add:function(e,t){var n,r=a.parent;if(n=H(e)?e:Q(y.log,null,null,e,t),l.meta&&null===n.meta&&(n.meta=W(3)),l.time&&(n.ts=C()),(n.parent=r).entries.push(n)>l.storeLast&&r.entries.splice(0,1),!0!==l.silent)for(var o=l.output.length;o--;)l.output[o](n);return n}}}function Z(e,t,n,r,o,l,a){return void 0===l&&(l=null),void 0===a&&(a=null),{cid:++K,ts:C(),level:e,type:d.scope,badge:t,label:n,parent:null,message:r,detail:{info:o,state:a},meta:l,entries:[]}}var ee=null;function te(){return ee}function ne(e,t){if(null!==e){var n,r=ee,o=e.scope,l=e.scopeContext;return(ee=e).scope=t,e.scopeContext&&(n=e.scopeContext.parent,e.scopeContext.parent=t.scope()),{activeContext:r,ctx:e,scope:o,scopeContext:l,scopeContextParent:n}}ee=null}function re(e){var t=e.ctx,n=e.scopeContext;t.scope=e.scope,(t.scopeContext=n)&&(n.parent=e.scopeContextParent),ee=e.activeContext}function oe(s,f){null==s.silent&&(s.silent=!/^(about:|file:|https?:\/\/localhost\/)/.test(location+"")),null==s.time&&(s.time=!0),null==s.meta&&(s.meta=!1),null==s.storeLast&&(s.storeLast=1e3),null==s.output&&(s.output=[]);var t=Z(y.info,"üöß","#root",null,null),p={logger:null,parent:t},n=X(s,p);p.logger=n;var r=f({createLogEntry:Q,levels:y,logger:n});return["add","clear","scope","setup","getEntries","getLastEntry"].forEach(function(e){if(r.hasOwnProperty(e))throw new SyntaxError('[octologger] "'+e+'" is a reserved identifier')}),r.print=function(){!function n(e){e.printed=!1,e.entries.forEach(function(e){for(var t=s.output.length;t--;)e.printed=!1,s.output[t](e);e.type===d.scope&&n(e)})}(t);for(var e=s.output.length;e--;)s.output[e](null)},r.add=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.add(Q(y.log,null,null,null,e))},r.clear=function(){return t.entries.splice(0,t.entries.length)},r.setup=function(e){for(var t in e)e.hasOwnProperty(t)&&(s[t]=e[t])},r.getEntries=function(){return t.entries},r.getLastEntry=function(){return t.entries[t.entries.length-1]||null},r.scope=function e(t,n,r){if(0===arguments.length)return this._scopeEntry;null==r&&"function"==typeof n&&(r=n,n=null);var o=H(t)?t:Z(y.info,null,null,t,n,s.meta?W(2):null);p.logger.add(o);var l=X(s,{parent:o}),a=f({createLogEntry:Q,levels:y,logger:l});if(a.add=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return l.add(Q(y.log,null,null,null,e))},a.scope=e,a._scopeEntry=o,"function"==typeof r){var u=ee,i=p.parent,c=p.logger;ee={entry:o,scope:a,logger:l,options:s,scopeContext:p},p.parent=o,r(a),ee=u,p.parent=i,p.logger=c}return a},r}var le={info:"‚ùï",warn:"‚ö†Ô∏è",error:"üõë",verbose:"üîé",debug:"‚ÅâÔ∏è",success:"‚úÖ"},ae=oe({meta:!1,output:[J()]},function(e){var r=e.levels,o=e.logger;return Object.keys(r).reduce(function(e,n){return e[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.add(Q(r[n],le[n]||null,null,null,e))},e},{})}),ue={fn:"<anonymous>",file:"",line:0,column:0};var ie={0:{level:y.info,badge:null,label:"success"},1:{level:y.warn,badge:"‚ö†Ô∏è",label:"cancelled"},2:{level:y.error,badge:"‚ùå",label:"failed"}};var ce={};function se(l,a,e,r,t,o,u){var i="setInterval"===a||o,c=C(),n={pid:null,start:c,end:null,delay:e},s=l.options.meta?W(3):null,f=l.scope.scope(Z(y.verbose,"‚è≤",null,'Timer "'+a+'" started',n,s,v)),p=f.scope().detail,d=function(e){var t=p.state===b,n=+t+2*+(null!=e),r=ie[n],o=C();p.state=0===n?i?v:h:1===n?b:E,p.info.end=o,l.scopeContext.logger.add(Q(r.level,r.badge,r.label,'Timer "'+a+'"'+(i?" step":"")+" "+(0===n?"completed successfully":1===n?b:E),{error:e,cancelled:t,start:c,duration:o-c},s)),c=o},m=t(function(e){var t=ne(l,f),n=null;c=C(),p.state=g;try{if(o)r(e);else if(r.length&&u.length)switch(u.length){case 1:r(u[0]);break;case 2:r(u[0],u[1]);break;case 3:r(u[0],u[1],u[2]);break;case 4:r(u[0],u[1],u[2],u[3]);break;case 5:r(u[0],u[1],u[2],u[3],u[4]);break;default:r.apply(void 0,u)}else r()}catch(e){n=e,T.console.error(e)}d(n),re(t)},e);return n.pid=m,ce[fe(a,m)]={pid:m,resolve:d,ctx:l,detail:p,scope:f},m}function fe(e,t){return("setTimeout"===e||"setInterval"===e?"timeout":e)+t}var pe=["Timeout","Interval","Immediate","AnimationFrame","IdleCallback"];function de(o,l){pe.forEach(function(e){var t="AnimationFrame"===e||"IdleCallback"===e,n=(t?"request":"set")+e,r=(t?"cancel":"clear")+e;l(t,n,o[n],r,o[r])})}function me(e,l,a,u,t,n){e[a]=function(e,t){void 0===t&&(t=0);for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=te();return null===o?l?u(e):u.apply(void 0,[e,t].concat(n)):se(o,a,t,e,u,l,n)},e[t]=function(e){!function(e,t,n){n(e);var r=fe(t,e),o=ce[r];if(void 0!==o){var l=ne(o.ctx,o.scope);o.detail.state=b,o.resolve(null),re(l),delete ce[r]}}(e,a,n)},p(e,a),p(e,t)}function ve(l){de(Y,function(e,t,n,r,o){l[t]===n&&me(l,e,t,n,r,o)})}function ge(l){de(Y,function(e,t,n,r,o){l[t]=n,l[r]=o})}e.EntryTypes=d,e.STATE_OK="ok",e.STATE_IDLE=v,e.STATE_BUSY="BUSY",e.STATE_INTERACTIVE=g,e.STATE_PENDING="pending",e.STATE_COMPLETED=h,e.STATE_ABORTED="ABORTED",e.STATE_CANCELLED=b,e.STATE_FAILED=E,e.STATE_ERROR="error",e.STATE_RESOLVED="resolved",e.STATE_REJECTED="rejected",e.isLogEntry=H,e.createLogEntry=Q,e.getMeta=W,e.createScopeEntry=Z,e.getLoggerContext=te,e.switchLoggerContext=ne,e.revertLoggerContext=re,e.createLogger=oe,e.octologger=ae,e.logger=ae,e.parseError=function(e){var t=r(e.stack),n=t[0]||ue;return{name:e.name,message:e.message,fn:n.fn,file:e.fileName||n.file,line:e.lineNumber||n.line,column:e.columnNumber||n.column,stack:t}},e.createFormat=m,e.nodeFromat=I,e.resetFormatStyle=w,e.browserFormat=x,e.createOutput=$,e.nodeOutput=z,e.browserOutput=G,e.universalOutput=J,e.parseStackRow=s,e.parseStack=r,e.LogLevels=y,e.LogLevelsInvert=o,e.eachTimers=de,e.patchTimers=ve,e.revertPatchTimers=ge,e.patchPromise=function(e){},e.revertPatchPromise=function(e){},e.patchNativeAPI=function(e){ve(e)},e.revertPatchNativeAPI=function(e){ge(e)},Object.defineProperty(e,"__esModule",{value:!0})});
