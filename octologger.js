!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.octologger={})}(this,function(e){"use strict";var d={entry:0,scope:1},v="idle",g="interactive",h="completed",b="cancelled",E="failed",y={error:0,warn:1,info:2,verbose:3,debug:4,log:5,success:6},o={};for(var t in y)o[y[t]]=t;var l=/at\s+(?:([^\s]+)(?:.*?)\()?((?:http|file|\/)[^)]+:\d+)\)?/,a=/^(.*?)(?:\/<)*@(.*?)$/,u=/^()(https?:\/\/.+)/,i=/^(.*?):(\d+)(?::(\d+))?$/,s="<anonymous>";function c(e){if(null==e)return null;var t=e.match(l);if(null===t&&(t=e.match(a)||e.match(u)),t){var n=t[2].match(i),r={fn:void 0===t[1]?s:t[1].trim()||s,file:"",line:0,column:0};return n&&(r.file=n[1],r.line=parseInt(n[2],10)||0,r.column=parseInt(n[3],10)||0),r}return null}function r(e){if(null==e)return null;for(var t=e.trim().split("\n"),n=[],r=0;r<t.length;r++){var l=c(t[r]);null!==l&&n.push(l)}return n}var T=Function("return this")(),I="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:Date.now;function p(e,t){var n=e<10?"0"+e:e;return 1<t&&e<100&&(n="0"+n),n}var n=/:([^;]+)/g;function f(n,r){return function(e){var t=o[e.level];return r(t,e,{base:n.level[t],label:n.label[t]})}}var m=f({level:{error:"[31m",warn:"[33m",log:"[0m",info:"[34m",success:"[34m",verbose:"[35m",debug:"[35m"},label:{error:"[4m",warn:"[4m",log:"[4m",info:"[4m",success:"[4m",verbose:"[4m",debug:"[4m"}},function(e,t,n){var r=[];return null!==t.badge&&r.push(t.badge),null!==t.label&&r.push(""+n.base+n.label+t.label+"[0m"),null!==t.message&&r.push(""+n.base+t.message),null!==t.detail&&r.push(t.detail),null!==t.meta&&r.push(t.meta.file+":"+t.meta.line+":"+t.meta.column+" ("+t.meta.fn+")"),r.push("[0m"),r}),C="text-decoration: underline; font-weight: bold;";function w(e){return e.replace(n,": inherit")}var x=f({level:{error:"color: red;",warn:"color: orange;",log:"color: #333;",success:"color: #1aaa55;",info:"color: dodgerblue;",verbose:"color: magenta;",debug:"color: #8b1fdd;"},label:{error:C,warn:C,log:C,info:C,success:C,verbose:C,debug:C}},function(e,t,n){var r,l,o=[],a=[];if(null!==t.ts&&(o.push("%c[%s] "),a.push(n.base,(r=t.ts,p((l=r/1e3)/60%24|0)+":"+p(l%60|0)+"."+p(r%1e3|0,2)))),null!==t.badge&&(o.push("%s"),a.push(t.badge)),null!==t.label&&(o.push("%c%s%c "),a.push(n.label+n.base,t.label,w(n.label))),null!==t.message&&(o.push("%c%s "),a.push(n.base,t.message)),null!=t.detail){var u=t.detail,i=u.length;if(null===t.message&&0<=i&&0 in u){o.push("%c"),a.push(n.base);for(var s=0;s<i;s++){var c=u[s];o.push(("string"==typeof c?"%s":"%o")+" "),a.push(c)}}else o.push("%o "),a.push(u)}return null!==t.meta&&(o.push("%s"),a.push(t.meta.file+":"+t.meta.line+":"+t.meta.column+" ("+t.meta.fn+")")),a.unshift(o.join("")),a}),L=T.console,A=T.setTimeout,k=T.clearTimeout,S=T.setInterval,P=T.clearInterval,O=T.setImmediate,F=T.clearImmediate,_=T.requestIdleCallback,N=T.cancelIdleCallback,D=T.requestAnimationFrame,j=T.cancelAnimationFrame,q=T.Promise,B=Object.freeze({console:L,setTimeout:A,clearTimeout:k,setInterval:S,clearInterval:P,setImmediate:O,clearImmediate:F,requestIdleCallback:_,cancelIdleCallback:N,requestAnimationFrame:D,cancelAnimationFrame:j,Promise:q}),R=function(e){void 0===e&&(e={});var t=e.out,n=void 0===t?L:t,r=e.format,l=void 0===r?m:r;return function(e){if(null!==e){var t=o[6===e.level?y.info:e.level];n[t].apply(n,l(e))}}},M=function(e){void 0===e&&(e={});var t=e.out,a=void 0===t?L:t,n=e.format,u=void 0===n?x:n,i=a.log,s=(a.group,a.groupEnd,a.groupCollapsed,{}),c=[];return function n(e,t){if(null===e)return c.forEach(function(){a.groupEnd()}),void(c.length=0);var r=e.parent,l=c.length;if(!t||!e.printed){if(0<l){for(var o=l;o--&&c[o]!==r;)c[o].printed=!0,a.groupEnd();c.length=o+1}if(e.type===d.scope)"idle"===e.detail.state?(e.printed=!0,i.apply(a,u(e))):(c.push(e),a.group.apply(a,u(e)));else{if(!t&&r.printed&&"#root"!==r.label)return void(s[r.cid]||(s[r.cid]=A(function(){c.forEach(function(){a.groupEnd()}),c.length=0;for(var e=[],t=r;e.unshift(t),"#root"!==(t=t.parent).label;);e.forEach(function(e){a.group.apply(a,u(e))}),r.entries.forEach(function(e){n(e,!0)}),e.forEach(function(){a.groupEnd()})})));e.printed=!0,i.apply(a,u(e))}}}},U="undefined"!=typeof window?M:R,Y=0;function $(e){return e&&e.hasOwnProperty("type")&&e.hasOwnProperty("level")}function z(e,t,n,r,l,o){return void 0===o&&(o=null),{cid:++Y,ts:null,type:d.entry,level:e,badge:t,label:n,message:r,detail:l,meta:o,parent:null,entries:[]}}function G(e){void 0===e&&(e=0);var t=Error.stackTraceLimit;Error.stackTraceLimit=e+1;var n=(new Error).stack.split("\n");return Error.stackTraceLimit=t,n.length<=e+1?null:c(n[e+1])}function V(o,a){return{add:function(e,t){var n,r=a.parent;if(n=$(e)?e:z(y.log,null,null,e,t),o.meta&&null===n.meta&&(n.meta=G(3)),o.time&&(n.ts=I()),(n.parent=r).entries.push(n)>o.storeLast&&r.entries.splice(0,1),!0!==o.silent)for(var l=o.output.length;l--;)o.output[l](n);return n}}}function H(e,t,n,r,l,o,a){return void 0===o&&(o=null),void 0===a&&(a=null),{cid:++Y,ts:I(),level:e,type:d.scope,badge:t,label:n,parent:null,message:r,detail:{info:l,state:a},meta:o,entries:[]}}var J=null;function K(){return J}function Q(e,t){if(null!==e){var n,r=J,l=e.scope,o=e.scopeContext;return(J=e).scope=t,e.scopeContext&&(n=e.scopeContext.parent,e.scopeContext.parent=t.scope()),{activeContext:r,ctx:e,scope:l,scopeContext:o,scopeContextParent:n}}J=null}function W(e){var t=e.ctx,n=e.scopeContext;t.scope=e.scope,(t.scopeContext=n)&&(n.parent=e.scopeContextParent),J=e.activeContext}function X(c,p){null==c.silent&&(c.silent=!/^(about:|file:|https?:\/\/localhost\/)/.test(location+"")),null==c.time&&(c.time=!0),null==c.meta&&(c.meta=!1),null==c.storeLast&&(c.storeLast=1e3),null==c.output&&(c.output=[]);var t=H(y.info,"üöß","#root",null,null),f={logger:null,parent:t},n=V(c,f);f.logger=n;var r=p({createLogEntry:z,levels:y,logger:n});return["add","clear","scope","setup","getEntries","getLastEntry"].forEach(function(e){if(r.hasOwnProperty(e))throw new SyntaxError('[octologger] "'+e+'" is a reserved identifier')}),r.print=function(){!function n(e){e.printed=!1,e.entries.forEach(function(e){for(var t=c.output.length;t--;)e.printed=!1,c.output[t](e);e.type===d.scope&&n(e)})}(t);for(var e=c.output.length;e--;)c.output[e](null)},r.add=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.add(z(y.log,null,null,null,e))},r.clear=function(){return t.entries.splice(0,t.entries.length)},r.setup=function(e){for(var t in e)e.hasOwnProperty(t)&&(c[t]=e[t])},r.getEntries=function(){return t.entries},r.getLastEntry=function(){return t.entries[t.entries.length-1]||null},r.scope=function e(t,n,r){if(0===arguments.length)return this._scopeEntry;null==r&&"function"==typeof n&&(r=n,n=null);var l=$(t)?t:H(y.info,null,null,t,n,c.meta?G(2):null);f.logger.add(l);var o=V(c,{parent:l}),a=p({createLogEntry:z,levels:y,logger:o});if(a.add=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.add(z(y.log,null,null,null,e))},a.scope=e,a._scopeEntry=l,"function"==typeof r){var u=J,i=f.parent,s=f.logger;J={entry:l,scope:a,logger:o,options:c,scopeContext:f},f.parent=l,r(a),J=u,f.parent=i,f.logger=s}return a},r}var Z={info:"‚ùï",warn:"‚ö†Ô∏è",error:"üõë",verbose:"üîé",debug:"‚ÅâÔ∏è",success:"‚úÖ"},ee=X({meta:!0,output:[U()]},function(e){var r=e.levels,l=e.logger;return Object.keys(r).reduce(function(e,n){return e[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];l.add(z(r[n],Z[n]||null,null,null,e))},e},{})}),te={fn:"<anonymous>",file:"",line:0,column:0};var ne={0:{level:y.info,badge:null,label:"success"},1:{level:y.warn,badge:"‚ö†Ô∏è",label:"cancelled"},2:{level:y.error,badge:"‚ùå",label:"failed"}};var re={};function le(o,a,e,r,t,l,u){var i="setInterval"===a||l,s=I(),n={pid:null,start:s,end:null,delay:e},c=o.options.meta?G(3):null,p=o.scope.scope(H(y.verbose,"‚è≤",null,'Timer "'+a+'" started',n,c,v)),f=p.scope().detail,d=function(e){var t=f.state===b,n=+t+2*+(null!=e),r=ne[n],l=I();f.state=0===n?i?v:h:1===n?b:E,f.info.end=l,o.scopeContext.logger.add(z(r.level,r.badge,r.label,'Timer "'+a+'"'+(i?" step":"")+" "+(0===n?"completed successfully":1===n?b:E),{error:e,cancelled:t,start:s,duration:l-s},c)),s=l},m=t(function(e){var t=Q(o,p),n=null;s=I(),f.state=g;try{if(l)r(e);else if(r.length&&u.length)switch(u.length){case 1:r(u[0]);break;case 2:r(u[0],u[1]);break;case 3:r(u[0],u[1],u[2]);break;case 4:r(u[0],u[1],u[2],u[3]);break;case 5:r(u[0],u[1],u[2],u[3],u[4]);break;default:r.apply(void 0,u)}else r()}catch(e){n=e,T.console.error(e)}d(n),W(t)},e);return n.pid=m,re[oe(a,m)]={pid:m,resolve:d,ctx:o,detail:f,scope:p},m}function oe(e,t){return("setTimeout"===e||"setInterval"===e?"timeout":e)+t}var ae=["Timeout","Interval","Immediate","AnimationFrame","IdleCallback"];function ue(l,o){ae.forEach(function(e){var t="AnimationFrame"===e||"IdleCallback"===e,n=(t?"request":"set")+e,r=(t?"cancel":"clear")+e;o(t,n,l[n],r,l[r])})}function ie(e,o,a,u,t,n){e[a]=function(e,t){void 0===t&&(t=0);for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var l=K();return null===l?o?u(e):u.apply(void 0,[e,t].concat(n)):le(l,a,t,e,u,o,n)},e[t]=function(e){!function(e,t,n){n(e);var r=oe(t,e),l=re[r];if(void 0!==l){var o=Q(l.ctx,l.scope);l.detail.state=b,l.resolve(null),W(o),delete re[r]}}(e,a,n)},pe(e,a),pe(e,t)}function se(o){ue(B,function(e,t,n,r,l){o[t]===n&&ie(o,e,t,n,r,l)})}function ce(o){ue(B,function(e,t,n,r,l){o[t]=n,o[r]=l})}function pe(e,t){e[t].toString=function(){return"function "+t+"() { [native code] }"},e[t].native=B[t]}e.EntryTypes=d,e.STATE_IDLE=v,e.STATE_BUSY="BUSY",e.STATE_INTERACTIVE=g,e.STATE_PENDING="pending",e.STATE_COMPLETED=h,e.STATE_ABORTED="ABORTED",e.STATE_CANCELLED=b,e.STATE_FAILED=E,e.isLogEntry=$,e.createLogEntry=z,e.getMeta=G,e.createScopeEntry=H,e.getLoggerContext=K,e.switchLoggerContext=Q,e.revertLoggerContext=W,e.createLogger=X,e.octologger=ee,e.logger=ee,e.parseError=function(e){var t=r(e.stack),n=t[0]||te;return{name:e.name,message:e.message,fn:n.fn,file:e.fileName||n.file,line:e.lineNumber||n.line,column:e.columnNumber||n.column,stack:t}},e.createFormat=f,e.nodeFromat=m,e.resetFormatStyle=w,e.browserFormat=x,e.nodeOutput=R,e.browserOutput=M,e.universalOutput=U,e.parseStackRow=c,e.parseStack=r,e.LogLevels=y,e.LogLevelsInvert=o,e.eachTimers=ue,e.patchTimers=se,e.revertPatchTimers=ce,e.patchNativeAPI=function(e){se(e)},e.revertPatchNativeAPI=function(e){ce(e)},Object.defineProperty(e,"__esModule",{value:!0})});
